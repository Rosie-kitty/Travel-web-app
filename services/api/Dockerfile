# --------------------------------------------------
# 1) Один стадийный образ: ставим все зависимости
# --------------------------------------------------
    FROM node:18

    # Указываем рабочую папку внутри контейнера
    WORKDIR /app
    
    # Копируем package*.json (чтобы закэшировать npm install)
    COPY package*.json ./
    
    # Устанавливаем ВСЕ зависимости (включая devDependencies),
    # чтобы внутри контейнера были доступны ts-node и nest-cli
    RUN npm install
    
    # Копируем весь исходный код (src, data-source.ts, app.module.ts, .env и т.д.)
    COPY . .
    
    # Экспортируем порт 3000
    EXPOSE 3000
    
    # По умолчанию запускаем команду, указанную в package.json: "start": "nest start"
    CMD ["npm", "run", "start"]
    